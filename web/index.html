<!DOCTYPE html>
<html/>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <link href="./css/index.css" rel="stylesheet" type="text/css" />
    <link href="./css/fonts.css" rel="stylesheet" type="text/css" />
    <link href="./css/theme/jquery-ui.css" rel="stylesheet" type="text/css" />
    <title>02min - Timer</title>
</head>
<body>
	<table class="plain">
		<tr>
			<td>
				<table style="font-size:300pt; color:#006600" align="center" id="digit">
					<tr>
						<td id="0-digit">
							0
						</td>
						<td id="1-digit">
							0
						</td>
						<td id="x-digit">
							:
						</td>
						<td  id="2-digit">
							0
						</td>
						<td  id="3-digit">
							0
						</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td>
				&nbsp;
			</td>
		</tr>
		<tr>
			<td>
				<input type="hidden" id="input-digit" value="0000"/>
			</td>
		</tr>
	</table>
</body>
<script type="text/javascript">
	var isStarted = false;

	var audio = new Audio("beep.wav");

	$(function() {
		$("#input-digit").val("200");
		changeTimeout();
	});

	function tickDown() {
		var mins = parseInt($("#0-digit").html()+$("#1-digit").html());
		var secs = parseInt($("#2-digit").html()+$("#3-digit").html());
		if (secs > 0) {
			secs--;
			secs = secs.toString().length == 1 ?  "0" + secs.toString() : secs.toString();
			$("#2-digit").html(secs.toString().substr(0,1));
			$("#3-digit").html(secs.toString().substr(1));
		} else {
			if (mins > 0) {
				mins--;
				mins = mins.toString().length == 1 ? "0" + mins.toString() : mins.toString();
				$("#0-digit").html(mins.toString().substr(0,1));
				$("#1-digit").html(mins.toString().substr(1));
				$("#2-digit").html("5");
				$("#3-digit").html("9");
			} else {
				isStarted = false;
				$("#digit").css("color", "#ff0000");
				audio.play();
			}
		}

		if (isStarted) {
			setTimeout("tickDown()", 1000);
		}
	}

	function changeTimeout() {
			var time = $("#input-digit").val();
			while(time.length != 4) {
				time = time.length < 4 ? '0' + time : time.substr(1)
			}
			$("#input-digit").val(time);
			for (var i=0; i<4; i++) {
				$("#" + i +"-digit").html(time.substr(i, 1));
			}
	};

	$("body").keydown(function(e){
		var key = String.fromCharCode(e.which);
		if (e.keyCode == 32) {
			isStarted = !isStarted;
			if (isStarted) {
				$("#digit").css("color", "#006600");
				setTimeout("tickDown()", 1000);
			}
		}
		if (!isStarted && ("01234567890").indexOf(key) >= 0) {
			console.log("yes");
			$("#input-digit").val($("#input-digit").val() + key);
			changeTimeout();
		}
		if (!isStarted && key.toUpperCase() == "C") {
			audio.play();
		}
	});
</script>
